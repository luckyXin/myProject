<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="LegalAreaLeaderAuditxml">
	<select id="selectLegalAreaLeaderAuditount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT
		count(1) FROM
		dbo.pro_singleProjectArrange t1
		inner JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
	</select>

	<select id="selectlegalSectionChiefAuditpages"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM
		(
		SELECT
		t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName
		FROM
		dbo.pro_singleProjectArrange t1
		inner JOin dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) t1.id as id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>
   
   <!-- 查询已审批的单项目条数  -->
	<select id="findlegalSectionChiefAuditSingleProjectCounts"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>

   <!-- 查询已审批单项目的信息  -->
	<select id="findlegalSectionChiefAuditSingleProjects" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct (t1.id),t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		t1.id,t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		t1.id, t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#)
		AND id not
		in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>


	<select id="findNolegalSectionChiefAuditPackProjectCounts"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count (distinct t1.id) FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId = t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
	</select>

	<select id="findNolegalSectionChiefAuditPackProjects" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM
		(
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2 ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) t1.id as id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>


    <!-- 查询已审批的打包项目条数 -->
	<select id="findlegalSectionChiefAuditPackProjectCounts" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t1.ownerId = t3.id
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
		</isNotEmpty>
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
	</select>

    <!-- 查询已审批打包信息  -->
	<select id="findlegalSectionChiefAuditPackProjects" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		distinct
		t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_legalAreaLeaderAudit t
		WHERE
		userAccount = #userAccount#)
		AND id not
		in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>
	





    <!-- 查询已审批的所有项目条数  -->
	<select id="findlegalSectionChiefAuditAllProjectCounts" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT count(distinct id) FROM (
		SELECT
		t1.id as id FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t3.id
		= t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT t1.id as id FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN dbo.pro_packProjectRelate
		t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
	</select>

    <!-- 查询已审批的所有项目信息  -->
	<select id="findlegalSectionChiefAuditAllProjects" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM (
		SELECT
		t2.id
		as id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id,t3.projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) id
		FROM
		(SELECT t2.id FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id
		FROM
		dbo.pro_legalAreaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) ta
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<select id="findNolegalSectionChiefAuditAllProjectCounts"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(ID) FROM
		(
		SELECT
		t1.id FROM
		dbo.pro_singleProjectArrange t1
		inner JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT distinct t1.id FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId = t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
	</select>

	<select id="findNolegalSectionChiefAuditAllProjects" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM (
		SELECT
		t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as intermediary,
		t6.username as mainAuditName FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		)ta
		WHERE ((id not in (SELECT top($pagesize$*($pageno$ - 1)) id FROM
		(SELECT t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as
		intermediary,
		t6.username as mainAuditName FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t5.intermediaryname as
		intermediary,t4.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) ta
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>
	
	
	
	
	
	
	
	<select id="getlegalAreaLeaderAudit" parameterClass="com.audit.entity.project.LegalAreaLeaderAuditBaseInfo"
		resultClass="com.audit.entity.project.LegalAreaLeaderAuditBaseInfo">
		SELECT
		id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime
		FROM
		dbo.pro_legalAreaLeaderAudit
		WHERE
		userAccount =
		#userAccount#
		AND
		projectDateId = #projectDateId#
	</select>
	<!-- 增加法制科长审核 -->
	<insert id="addlegalAreaLeaderAudit" parameterClass="com.audit.entity.project.LegalAreaLeaderAuditBaseInfo">
		INSERT INTO
		pro_legalAreaLeaderAudit
		(id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime)
		VALUES
		(#id#
		,#projectDateId#
		,#remark#
		,#userAccount#
		,#passState#
		,#isSubmit#
		,getdate())
	</insert>
	
   <update id="updatelegalAreaLeaderAudit" parameterClass="com.audit.entity.project.LegalAreaLeaderAuditBaseInfo">
		UPDATE
		pro_legalAreaLeaderAudit
		SET
		remark = #remark#
		,passState = #passState#
		,isSubmit = #isSubmit#
		,createTime = getdate()
		WHERE id = #id#
	</update>


</sqlMap>