<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="legalSectionChiefAuditxml">
	<select id="selectlegalSectionChiefAuditcount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT
		count(1) FROM
		dbo.pro_singleProjectArrange t1
		inner JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
	</select>

	<select id="selectlegalSectionChiefAuditpage" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM
		(
		SELECT
		t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName
		FROM
		dbo.pro_singleProjectArrange t1
		inner JOin dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) t1.id as id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>


	<!-- 查询已审批单项目条数 -->
	<select id="findlegalSectionChiefAuditSingleProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>
	<!-- 查询已审批单项目信息 -->
	<select id="findlegalSectionChiefAuditSingleProject"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct (t1.id),t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		t1.id,t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		t1.id, t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#)
		AND
		id not
		in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>



	<select id="findNolegalSectionChiefAuditPackProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count (distinct t1.id) FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId = t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
	</select>

	<select id="findNolegalSectionChiefAuditPackProject"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM
		(
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2 ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) t1.id as id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<!-- 查询已审批的打包项目条数 -->
	<select id="findlegalSectionChiefAuditPackProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t1.ownerId = t3.id
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
		</isNotEmpty>
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM
		dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND
		id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
	</select>
	<!-- 查询已审批的打包项目信息 -->
	<select id="findlegalSectionChiefAuditPackProject"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM
		dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND
		id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		distinct
		t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_legalSectionChiefAudit t
		WHERE
		userAccount = #userAccount#)
		AND
		id not
		in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>



	<!-- 查询已审批的所有项目条数 -->
	<select id="findlegalSectionChiefAuditAllProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(distinct id) FROM (
		SELECT
		t1.id as id FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t3.id
		=
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		WHERE
		1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT t1.id as id FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN dbo.pro_packProjectRelate
		t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
	</select>
	<!-- 查询已审批的所有项目信息 -->

	<select id="findlegalSectionChiefAuditAllProject"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM (
		SELECT
		t2.id
		as id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange
		t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id,t3.projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) id
		FROM
		(SELECT t2.id FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id
		FROM
		dbo.pro_legalSectionChiefAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) ta
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<select id="findNolegalSectionChiefAuditAllProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(ID) FROM
		(
		SELECT
		t1.id FROM
		dbo.pro_singleProjectArrange t1
		inner JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT distinct t1.id FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId = t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
	</select>

	<select id="findNolegalSectionChiefAuditAllProject"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM (
		SELECT
		t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as intermediary,
		t6.username as mainAuditName FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		= t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t4.ownerName,t5.intermediaryname as
		intermediary,t6.username as mainAuditName
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		)ta
		WHERE ((id not in (SELECT top($pagesize$*($pageno$ - 1)) id FROM
		(SELECT t1.id,t3.projectName,t4.ownerName,t5.intermediaryname as
		intermediary,
		t6.username as mainAuditName FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		distinct t1.id,t1.packageName as
		projectName,t5.intermediaryname as
		intermediary,t4.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t4.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) ta
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<select id="getlegalSectionChiefAuditBaseInfo"
		parameterClass="com.audit.entity.project.LegalSectionChiefAuditBaseInfo"
		resultClass="com.audit.entity.project.LegalSectionChiefAuditBaseInfo">
		SELECT
		id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime
		FROM
		dbo.pro_legalSectionChiefAudit
		WHERE
		userAccount =
		#userAccount#
		AND
		projectDateId = #projectDateId#
	</select>
	<!-- 增加法制科长审核 -->
	<insert id="addlegalSectionChiefAudit"
		parameterClass="com.audit.entity.project.LegalSectionChiefAuditBaseInfo">
		INSERT INTO
		pro_legalSectionChiefAudit
		(id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime)
		VALUES
		(#id#
		,#projectDateId#
		,#remark#
		,#userAccount#
		,#passState#
		,#isSubmit#
		,getdate())
	</insert>

	<update id="updatelegalSectionChiefAudit"
		parameterClass="com.audit.entity.project.LegalSectionChiefAuditBaseInfo">
		UPDATE
		pro_legalSectionChiefAudit
		SET
		remark = #remark#
		,passState = #passState#
		,isSubmit = #isSubmit#
		,createTime = getdate()
		WHERE id = #id#
	</update>
	<update id="updateCectionChiefAuditstate" parameterClass="java.lang.String">
		UPDATE
		dbo.pro_sectionChiefAudit
		SET
		isSubmit = '0'
		WHERE
		projectDateId =
		#projectDateId#
	</update>


	<!-- 更改法制科长状态 -->
	<update id="updatelegalsection" parameterClass="java.lang.String">
		update pro_legalSectionChiefAudit
		set isSubmit='0'
		where projectDateId=#projectDateId#
    </update>
	<!-- 更改法制分管状态 -->
	<update id="updatelegalAreeLeader" parameterClass="java.lang.String">
		update pro_legalAreaLeaderAudit
		set isSubmit='0'
		where projectDateId=#projectDateId#
    </update>
	<!-- 更改分管审核状态 -->
	<update id="updateareaLeaderAudit" parameterClass="java.lang.String">
		update pro_areaLeaderAudit
		set isSubmit='0'
		where projectDateId=#projectDateId#
    </update>

	<!-- 检索安排之后的项目总数 -->
	<select id="getNoWriteIntermediatyProjectCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT t.id,t1.projectName,t2.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as
		projectTime,t3.username FROM dbo.pro_singleProjectArrange t
		LEFT JOIN
		dbo.pro_datapreinfo t1
		ON t.datapreId = t1.id
		LEFT JOIN
		dbo.sys_projectowner t2
		ON t1.proownerid = t2.id
		LEFT JOIN
		dbo.sys_userinfo t3
		ON t3.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.projectName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t2.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		union
		SELECT t.id,t.packageName as projectName,t1.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as projectTime,
		t2.username as userName FROM dbo.pro_packProjectArrange t
		LEFT JOIN
		dbo.sys_projectowner t1
		ON t.ownerId = t1.id
		LEFT JOIN dbo.sys_userinfo
		t2
		ON t2.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.packageName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t1.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		<isEqual property="auditType" compareValue="0">
			AND t.intermediaryId is null
		</isEqual>
		) t
	</select>

	<!-- 检索安排之后的项目 -->
	<select id="getNoWriteIntermediatyProject" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$ id,projectName,ownerName,projectTime,userName
		FROM (
		SELECT t.id,t1.projectName,t2.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as projectTime,t3.username as userName FROM dbo.pro_singleProjectArrange
		t
		LEFT JOIN dbo.pro_datapreinfo t1
		ON t.datapreId = t1.id
		LEFT JOIN dbo.sys_projectowner t2
		ON t1.proownerid = t2.id
		LEFT JOIN dbo.sys_userinfo t3
		ON t3.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.projectName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t2.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		<isEqual property="auditType" compareValue="0">
			AND t.intermediaryId is null
		</isEqual>
		union
		SELECT t.id,t.packageName as projectName,t1.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as projectTime, t2.username as userName FROM dbo.pro_packProjectArrange
		t
		LEFT JOIN dbo.sys_projectowner t1
		ON t.ownerId = t1.id
		LEFT JOIN dbo.sys_userinfo t2
		ON t2.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.packageName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t1.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		<isEqual property="auditType" compareValue="0">
			AND t.intermediaryId is null
		</isEqual>
		) t
		WHERE id not in(
		SELECT top ($pagesize$*($pageno$ - 1)) id FROM (
		SELECT t.id,t1.projectName,t2.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as projectTime,t3.username FROM dbo.pro_singleProjectArrange t
		LEFT JOIN dbo.pro_datapreinfo t1
		ON t.datapreId = t1.id
		LEFT JOIN dbo.sys_projectowner t2
		ON t1.proownerid = t2.id
		LEFT JOIN dbo.sys_userinfo t3
		ON t3.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.projectName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t2.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		<isEqual property="auditType" compareValue="0">
			AND t.intermediaryId is null
		</isEqual>
		union
		SELECT t.id,t.packageName as projectName,t1.ownerName,
		SUBSTRING(CONVERT(varchar,t.projectTime, 120),0,12)
		as projectTime, t2.username as userName FROM dbo.pro_packProjectArrange
		t
		LEFT JOIN dbo.sys_projectowner t1
		ON t.ownerId = t1.id
		LEFT JOIN dbo.sys_userinfo t2
		ON t2.userAccount = t.userAccount
		WHERE 1=1
		<isNotEmpty property="projectName">
			AND t.packageName like '%$projectName$%'
	    </isNotEmpty>
		<isNotEmpty property="ownerName">
			AND t1.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isEqual property="auditType" compareValue="1">
			AND t.intermediaryId is not null
		</isEqual>
		<isEqual property="auditType" compareValue="0">
			AND t.intermediaryId is null
		</isEqual>
		) t
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

    <!-- 检查安排信息中的中介机构信息  -->
	<select id="getArrangeProjectBaseInfoById" parameterClass="java.lang.String"
		resultClass="com.audit.entity.project.ArrangeProject">
		SELECT ID,intermediaryId,intermediaryName,arrangeTime FROM
		(SELECT t.id,t.intermediaryId,t1.intermediaryname as intermediaryName, t.projectTime as arrangeTime
		FROM dbo.pro_packProjectArrange t
		LEFT JOIN dbo.sys_intermediaryagency t1
		ON t.intermediaryId = t1.id
		union
		SELECT t.id,t.intermediaryId,t1.intermediaryname as intermediaryName,
		t.projectTime as arrangeTime
		 FROM
		dbo.pro_singleProjectArrange t
		LEFT JOIN dbo.sys_intermediaryagency t1
		ON t.intermediaryId = t1.id) t
		WHERE id = #id#
	</select>
</sqlMap>