<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="Intermediaryauditxml">
    <typeAlias alias="IntermediaryAudit" type="com.audit.entity.project.IntermediaryAudit"/>
    
     <typeAlias alias="ProIntermediaryAudit" type="com.audit.entity.project.ProIntermediaryAudit"/>
    
    <!-- 查询需要中介审核的单项目安排-->
    <select id="selectIntermediaryAuditpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">   
	      select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.interid,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
		select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,a.id as interid,s.intermediarySendTime,a.deferday,a.auditoktime,s.intermediaryAuditTime,a.isconfirm ,f.userAccount,s.isUrgent,s.timeLimit  from pro_singleProjectArrange s inner join  flowView_mywork f on s.datapreId=f.projectDateId 
		inner join pro_datapreinfo d on d.id=f.projectDateId
		left join pro_intermediaryaudit a on a.arrangeId=s.id
		where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t where 1=1
		<isNotEmpty property="projectName">
                 AND t.projectName like '%$projectName$%'
          </isNotEmpty>
         <isNotEmpty property="proownerid">
                 AND  t.proownerid = #proownerid#
         </isNotEmpty>
         <isNotEmpty property="intermediaryId">
                 AND  t.intermediaryId = #intermediaryId#
         </isNotEmpty>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
          <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
          <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
         
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
               <isEqual property="isconfirm" compareValue="0">
                      (t.isconfirm = #isconfirm#  or t.isconfirm is null)
               </isEqual>
                <isEqual property="isconfirm" compareValue="1">
                            t.isconfirm = #isconfirm#
                 </isEqual>
             </isNotEmpty>
         </dynamic>
	    <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>

	</select>
	
	  <select id="selectIntermediaryAuditcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">   
	  select count(1) from(
		select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,a.id as interid,s.intermediarySendTime,a.deferday,a.auditoktime,s.intermediaryAuditTime,a.isconfirm ,f.userAccount,s.isUrgent,s.timeLimit  from pro_singleProjectArrange s inner join  flowView_mywork f on s.datapreId=f.projectDateId 
		inner join pro_datapreinfo d on d.id=f.projectDateId
		left join pro_intermediaryaudit a on a.arrangeId=s.id
		where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t where 1=1
		 <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId" >
                  <isEqual ></isEqual>
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
        <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
                        <isEqual property="isconfirm" compareValue="0">
                          (isconfirm = #isconfirm#  or isconfirm is null)
                       </isEqual>
                        <isEqual property="isconfirm" compareValue="1">
                            isconfirm = #isconfirm#
                         </isEqual>
             </isNotEmpty>
         </dynamic>
	</select>
	
	
	<!-- 查询中介审核的打包项目 -->
	<select  id="selectIntermediaryAuditpackpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">
	      select t.arrangeId ,t.packageName as projectName,t.proownerid,t.sendAmount as sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
		select pa.id as arrangeId,pa.packageName,d.proownerid,pa.sendAmount,pa.intermediaryId
		,pa.intermediarySendTime,a.deferday,a.auditoktime,pa.intermediaryAuditTime,a.isconfirm ,
		f.userAccount,pa.isUrgent,pa.timeLimit  from pro_packProjectRelate pr 
		inner join  flowView_mywork f on pr.projectId=f.projectDateId 
		inner join  pro_packProjectArrange pa on pa.id=pr.projectPackId
		inner join pro_datapreinfo d on d.id=f.projectDateId
		left join pro_intermediaryaudit a on a.arrangeId=pa.intermediaryId
		where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t  where 1=1 
	  <isNotEmpty property="projectName">
                 AND t.packageName like '%$projectName$%'
          </isNotEmpty>
         <isNotEmpty property="proownerid">
                 AND  t.proownerid = #proownerid#
         </isNotEmpty>
         <isNotEmpty property="intermediaryId">
                 AND  t.intermediaryId = #intermediaryId#
         </isNotEmpty>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
        <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
                       <isEqual property="isconfirm" compareValue="0">
                          (isconfirm = #isconfirm#  or isconfirm is null)
                       </isEqual>
                        <isEqual property="isconfirm" compareValue="1">
                            isconfirm = #isconfirm#
                         </isEqual>
             </isNotEmpty>
         </dynamic>
          group by t.arrangeId,t.packageName,t.proownerid,t.sendAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit
	    <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>
	</select>
	
	
	<select id="selectIntermediaryAuditpackcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">   
		select COUNT(1) from
		 (select t.arrangeId ,t.packageName as projectName,t.proownerid,t.sendAmount as sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
				select pa.id as arrangeId,pa.packageName,d.proownerid,pa.sendAmount,pa.intermediaryId
				,pa.intermediarySendTime,a.deferday,a.auditoktime,pa.intermediaryAuditTime,a.isconfirm ,
				f.userAccount,pa.isUrgent,pa.timeLimit  from pro_packProjectRelate pr 
				inner join  flowView_mywork f on pr.projectId=f.projectDateId 
				inner join  pro_packProjectArrange pa on pa.id=pr.projectPackId
				inner join pro_datapreinfo d on d.id=f.projectDateId
				left join pro_intermediaryaudit a on a.arrangeId=pa.intermediaryId
				where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t  where 1=1 
				 group by t.arrangeId,t.packageName,t.proownerid,t.sendAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit 
		) t where 1=1
		 <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
        <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
          <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
          <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
                        <isEqual property="isconfirm" compareValue="0">
                          (isconfirm = #isconfirm#  or isconfirm is null)
                       </isEqual>
                         <isEqual property="isconfirm" compareValue="1">
                            isconfirm = #isconfirm#
                         </isEqual>
                      
             </isNotEmpty>
         </dynamic>
	</select>
	
		<!-- 查询中介未录入的全部项目 -->
	 <select id="selectIntermediaryAuditnosubmitallpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">  
	       select t.* from
		(
				select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
				select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,s.intermediarySendTime,a.deferday,a.auditoktime,s.intermediaryAuditTime,a.isconfirm ,f.userAccount,s.isUrgent,s.timeLimit  from pro_singleProjectArrange s inner join  flowView_mywork f on s.datapreId=f.projectDateId 
				inner join pro_datapreinfo d on d.id=f.projectDateId
				left join pro_intermediaryaudit a on a.arrangeId=s.id
				where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t where 1=1
		union all
		select t.arrangeId ,t.packageName as projectName,t.proownerid,t.sendAmount as sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
				select pa.id as arrangeId,pa.packageName,d.proownerid,pa.sendAmount,pa.intermediaryId
				,pa.intermediarySendTime,a.deferday,a.auditoktime,pa.intermediaryAuditTime,a.isconfirm ,
				f.userAccount,pa.isUrgent,pa.timeLimit   from pro_packProjectRelate pr 
				inner join  flowView_mywork f on pr.projectId=f.projectDateId 
				inner join  pro_packProjectArrange pa on pa.id=pr.projectPackId
				inner join pro_datapreinfo d on d.id=f.projectDateId
				left join pro_intermediaryaudit a on a.arrangeId=pa.intermediaryId
				where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t  where 1=1 
			<isNotEmpty property="projectName">
                 AND t.packageName like '%$projectName$%'
          </isNotEmpty>
         <isNotEmpty property="proownerid">
                 AND  t.proownerid = #proownerid#
         </isNotEmpty>
         <isNotEmpty property="intermediaryId">
                 AND  t.intermediaryId = #intermediaryId#
         </isNotEmpty>
			group by t.arrangeId,t.packageName,t.proownerid,t.sendAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit
		) t where 1=1
	       
          <isNotEmpty property="projectName">
                 AND projectName like '%$projectName$%'
          </isNotEmpty>
         <isNotEmpty property="proownerid">
                 AND  proownerid = #proownerid#
         </isNotEmpty>
         <isNotEmpty property="intermediaryId">
                 AND  intermediaryId = #intermediaryId#
         </isNotEmpty>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
           <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
                       <isEqual property="isconfirm" compareValue="0">
                          ( isconfirm = #isconfirm#  or isconfirm is null)
                       </isEqual>
                        <isEqual property="isconfirm" compareValue="1">
                            isconfirm = #isconfirm#
                         </isEqual>
             </isNotEmpty>
         </dynamic>
	    <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>
	 
	 
	 </select>
	
	<!-- 查询中介未录入的全部项目条数 -->
	 <select id="selectIntermediaryAuditnosubmitallcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">  
	       select count(1) from
		(
		select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
				select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,s.intermediarySendTime,a.deferday,a.auditoktime,s.intermediaryAuditTime,a.isconfirm ,f.userAccount,s.isUrgent,s.timeLimit  from pro_singleProjectArrange s inner join  flowView_mywork f on s.datapreId=f.projectDateId 
				inner join pro_datapreinfo d on d.id=f.projectDateId
				left join pro_intermediaryaudit a on a.arrangeId=s.id
				where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t where 1=1
		
		union all
		select t.arrangeId ,t.packageName as projectName,t.proownerid,t.sendAmount as sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit  from(
				select pa.id as arrangeId,pa.packageName,d.proownerid,pa.sendAmount,pa.intermediaryId
				,pa.intermediarySendTime,a.deferday,a.auditoktime,pa.intermediaryAuditTime,a.isconfirm ,
				f.userAccount,pa.isUrgent,pa.timeLimit from pro_packProjectRelate pr 
				inner join  flowView_mywork f on pr.projectId=f.projectDateId 
				inner join  pro_packProjectArrange pa on pa.id=pr.projectPackId
				inner join pro_datapreinfo d on d.id=f.projectDateId
				left join pro_intermediaryaudit a on a.arrangeId=pa.intermediaryId
				where f.userAccount=#userAccount# and  f.module=#module# and f.state='0') t  where 1=1 
		group by t.arrangeId,t.packageName,t.proownerid,t.sendAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.userAccount,t.isUrgent,t.timeLimit
		) t where 1=1
	        <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
          <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="and">
             <isNotEmpty property="isconfirm">
                       <isEqual property="isconfirm" compareValue="0">
                          (isconfirm = #isconfirm#  or isconfirm is null)
                       </isEqual>
                        <isEqual property="isconfirm" compareValue="1">
                            isconfirm = #isconfirm#
                         </isEqual>
             </isNotEmpty>
         </dynamic> 
	     
	 </select>
	 <!-- 单项目审核按资料id查询信息 -->
	 <select id="selectsingleauditbyid" parameterClass="java.lang.String" resultClass="com.audit.entity.project.ResultClassArrangeInfo">
 select d.id as datapreId,d.datapreno,d.projectNo,d.constructId,d.constructlink,d.constructtelphone,d.datapreopinion,d.zbMoney,d.htmoney,d.zhanliemoney,pa.id as arrangeId,d.projectName,pa.projectTime , pa.mainAuditId,pa.isMySelfState,d.proownerid,d.proownerlink,d.proownertelphone,pa.intermediaryId,d.sentAmount,pa.intermediarySendTime,pa.intermediaryAuditTime,pa.isUrgent,pa.timeLimit from pro_singleProjectArrange pa inner join
         pro_datapreinfo d on  pa.datapreId=d.id where d.id=#id#
	 
	</select>
		<!--查询打包项目信息 -->
	<select id="selectpackauditbyid"  parameterClass="java.lang.String" resultClass="com.audit.entity.project.ResultClassArrangeInfo">
	select p.id as arrangeId,
	d.projectName,
	 SUBSTRING(CONVERT(varchar,
	p.projectTime, 120),0,12) as projectTime,
	t1.username as mainAuditId, 
	d.proownerid,
	p.intermediaryId,
	 p.isMySelfState,
	d.sentAmount,
	p.isUrgent,
	p.timeLimit,
	 SUBSTRING(CONVERT(varchar, p.intermediarySendTime, 120),0,12) as intermediarySendTime,
	 SUBSTRING(CONVERT(varchar,  p.intermediaryAuditTime, 120),0,12) as intermediaryAuditTime
        from pro_packProjectArrange p inner join        
          pro_packProjectRelate pr on p.id=pr.projectPackId
          inner join pro_datapreinfo d on d.id=pr.projectId
          LEFT JOIN dbo.sys_userinfo t1
          ON t1.id = p.mainAuditId
          where d.id=#id#  
     group by p.id ,d.projectName,p.projectTime, t1.username,d.proownerid,p.intermediaryId, p.isMySelfState,d.sentAmount,p.isUrgent,
	p.timeLimit,p.intermediarySendTime,p.intermediaryAuditTime 
	
	</select>
	
	<!-- 查询是否安排了复核工程师 -->
	<select id="selectisexistemp" parameterClass="java.lang.String" resultClass="java.lang.Integer">
	   select COUNT(1) from pro_employeeArrangeRelate where projectArrangeId=#id#
	</select>
	
	
	
	<!-- 查询单项目信息 -->
	<select id="selectsinglepackbyid" parameterClass="java.lang.String" resultClass="com.audit.entity.project.ResultClassArrangeInfo">
	    select d.id as datapreId,d.datapreno,d.projectNo,d.datapretime,d.constructId,d.constructlink,d.constructtelphone,d.datapreopinion,d.zbMoney,d.htmoney,d.zhanliemoney,pa.id as arrangeId,d.projectName,pa.projectTime ,pa.isMySelfState, pa.mainAuditId,d.proownerid,d.proownerlink,d.proownertelphone,pa.intermediaryId,d.sentAmount,pa.intermediarySendTime,pa.intermediaryAuditTime,pa.isUrgent,pa.timeLimit from pro_singleProjectArrange pa inner join
         pro_datapreinfo d on  pa.datapreId=d.id where pa.id=#arrangeId#
	</select>
	<!--查询打包项目信息 -->
	<select id="selectpackprobyid"  parameterClass="java.lang.String" resultClass="com.audit.entity.project.ResultClassArrangeInfo">
	select p.id as arrangeId,
	  p.packageName as projectName,
	  SUBSTRING(CONVERT(varchar,
		p.projectTime, 120),0,12) as projectTime,
	  t1.username as mainAuditId,
	  d.proownerid,
	  d.datapretime,
	  p.intermediaryId,
	  p.isMySelfState,
	  p.sendAmount as sentAmount,
	  p.isUrgent,
	  p.timeLimit,
	 SUBSTRING(CONVERT(varchar, p.intermediarySendTime, 120),0,12) as intermediarySendTime,
	 SUBSTRING(CONVERT(varchar,  p.intermediaryAuditTime, 120),0,12) as intermediaryAuditTime
        from pro_packProjectArrange p inner join        
          pro_packProjectRelate pr on p.id=pr.projectPackId
          inner join pro_datapreinfo d on d.id=pr.projectId
          LEFT JOIN dbo.sys_userinfo t1
          ON t1.id = p.mainAuditId
          where p.id=#arrangeId#  
     group by p.id ,p.packageName,p.projectTime,t1.username,d.proownerid,d.datapretime,p.intermediaryId,p.isMySelfState,p.sendAmount,p.isUrgent,
	  p.timeLimit,p.intermediarySendTime,p.intermediaryAuditTime 
	</select>
	
	<!-- 查询该包项目是否提交了 -->
	 <select id="selectispackprojectsubmit" parameterClass="java.lang.String" resultClass="java.lang.Integer">  
	 select count(1) from pro_intermediaryaudit where arrangeId=#id#  and isconfirm=1
	</select>
	
	
	<!-- 查询是否子项目都审核完了 -->
	 <select id="selectisallauditfinish" parameterClass="java.lang.String" resultClass="java.lang.Integer">  
	  select COUNT(1) from
			(
			select d.id as datapreId,d.projectName,d.proownerid,d.constructId,d.sentAmount,pa.id as arrangeId,pa.intermediaryId,pa.intermediaryAuditTime,pa.intermediarySendTime,inter.auditstate from  pro_datapreinfo d inner join    pro_packProjectRelate pr
			on d.id=pr.projectId
			inner join pro_packProjectArrange pa
			on pr.projectPackId=pa.id
			left join pro_intermediaryaudit inter
			on inter.datapreId=d.id
			where pa.id=#id# 
			union all
			select d.id as datapreId,d.projectName,d.proownerid,d.constructId,d.sentAmount,s.id as arrangeId,s.intermediaryId,s.intermediaryAuditTime,s.intermediarySendTime,inter.auditstate from pro_datapreinfo d inner join  pro_singleProjectArrange s on d.id=s.datapreId  
			left join pro_intermediaryaudit inter
			on inter.datapreId=d.id
			where s.id=#id#  
			) t  where t.auditstate=0 or t.auditstate is null
	 
	 
	 
	 
	 
	 
	 
	 
	 
	</select>
	<!-- 提交整个打包项目 -->
	<update id="updatesubmitpackpro" parameterClass="ProIntermediaryAudit">
	    update pro_intermediaryaudit 
	    set isconfirm=#isconfirm#,
	    auditoktime=#auditoktime#,
	    deferday=#deferday#,
	    overday=#overday#
	    where arrangeId=#arrangeId#
	</update>
	
	<!-- 查询打包项目的审定金额和审减总金额 -->
	<select id="selectauditandcutmoney"  parameterClass="java.lang.String" resultClass="ProIntermediaryAudit">
	     select datapreId,arrangeId,auditoktime,auditlv,deferday,overday,remark,auditmoney,cutmoney from pro_intermediaryaudit where arrangeId=#id# 
	
	</select>
	
	<!-- 查询中介审核是否有数据 -->
	<select id="selectintermediaryAuditobject" parameterClass="java.lang.String" resultClass="ProIntermediaryAudit">   
	     select * from pro_intermediaryaudit where arrangeId=#arrangeId#
	</select>
	
	<!-- 查询中介审核是否有数据 -->
	<select id="selectintermediaryAuditobjectbydatapreId" parameterClass="java.lang.String" resultClass="ProIntermediaryAudit">   
	     select * from pro_intermediaryaudit where datapreId=#datapreId#
	</select>
	
	<!-- 根据项目安排id查询下面的资料预审id -->
	<select id="selectsingeproid" parameterClass="java.lang.String" resultClass="com.audit.entity.project.Datapreinfo">
	    select d.id from pro_singleProjectArrange s inner join 
           pro_datapreinfo d on s.datapreId=d.id
            where s.id=#id#
	</select>
	
	<select id="selectpackproid" parameterClass="java.lang.String" resultClass="com.audit.entity.project.Datapreinfo">
	   SELECT t.projectId as id FROM pro_packProjectRelate t WHERE t.projectPackId=#id#
	</select>
	<!-- 录入中介审核 -->
	 <insert id="addIntermediaryAudit"  parameterClass="ProIntermediaryAudit">
           insert into pro_intermediaryaudit
           (id,auditmoney,cutmoney,auditlv,auditoktime,deferday,overday,remark,isconfirm,arrangeId,userAccount,datapreId,auditstate) 
           values
           (#id#,#auditmoney#,#cutmoney#,#auditlv#,#auditoktime#,#deferday#,#overday#,#remark#,#isconfirm#,#arrangeId#,#userAccount#,#datapreId#,#auditstate#) 
	  </insert>
	
	<!-- 修改中介审核 -->
	<update id="updateIntermediaryAudit"  parameterClass="ProIntermediaryAudit">
	     update pro_intermediaryaudit set 
	     auditmoney=#auditmoney#,
	     cutmoney=#cutmoney#,
	     auditlv=#auditlv#,
	     auditoktime=#auditoktime#,
	     deferday=#deferday#,
	     overday=#overday#,
	     remark=#remark#,
	     isconfirm=#isconfirm#,
	     userAccount=#userAccount#,
	     arrangeId=#arrangeId#,
	     datapreId=#datapreId#,
	     auditstate=#auditstate#
	     where id=#id#
	</update>
	
	
	<!-- 查询已录入的中介审核信息单项目 -->
	 <select id="selectIntermediaryAuditsubmitpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">   
	 
	    select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.interid,t.intermediarySendTime,t.intermediaryAuditTime,t.deferday,t.auditoktime,t.isconfirm,t.isUrgent,t.timeLimit  from(
		select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,i.id as interid,s.intermediarySendTime,i.deferday,i.auditoktime,s.intermediaryAuditTime,i.isconfirm,s.isUrgent,s.timeLimit
	    from pro_singleProjectArrange s inner join  pro_intermediaryaudit i on s.id=i.arrangeId 
		inner join pro_datapreinfo d on d.id=s.datapreId
		where  i.userAccount=#userAccount#) t where 1=1
		  <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
           <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>
	 </select>
	 
	 <select id="selectIntermediaryAuditsubmitcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">   
	     select count(1) from(
		select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,i.id as interid,s.intermediarySendTime,i.deferday,i.auditoktime,s.intermediaryAuditTime,i.isconfirm,s.isUrgent,s.timeLimit
	    from pro_singleProjectArrange s inner join  pro_intermediaryaudit i on s.id=i.arrangeId 
		inner join pro_datapreinfo d on d.id=s.datapreId
		where  i.userAccount=#userAccount#) t where 1=1
		  <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
	 </select>
	 
	 <!-- 查询已录入的中介审核信息打包项目 -->
	  <select id="selectIntermediaryAuditsubmitpackpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">   
		  select t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit from
		(
		select pa.id as arrangeId,pa.packageName as projectName,d.proownerid,pa.sendAmount as sentAmount,pa.intermediaryId,i.id as interid,pa.intermediarySendTime,pa.intermediaryAuditTime,i.isconfirm,i.auditoktime,pa.isUrgent,pa.timeLimit    from pro_packProjectRelate pr 
		 inner join pro_packProjectArrange pa on pr.projectPackId=pa.id
		 inner join pro_datapreinfo d on  d.id=pr.projectId
		 inner join pro_intermediaryaudit i on i.arrangeId=pa.id
		 where  i.userAccount=#userAccount#
		 ) 
		 t where 1=1
		  <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
          <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          group by t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime ,t.isUrgent,t.timeLimit
          <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>
	 </select>
	  <select id="selectIntermediaryAuditsubmitpackcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">   
	    select COUNT(1)				
			from
			(
			    select t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit from
				(
				select pa.id as arrangeId,pa.packageName as projectName,d.proownerid,pa.sendAmount as sentAmount,pa.intermediaryId,i.id as interid,pa.intermediarySendTime,pa.intermediaryAuditTime,i.isconfirm ,i.auditoktime,pa.isUrgent,pa.timeLimit   from pro_packProjectRelate pr 
				 inner join pro_packProjectArrange pa on pr.projectPackId=pa.id
				 inner join pro_datapreinfo d on  d.id=pr.projectId
				 inner join pro_intermediaryaudit i on i.arrangeId=pa.id
				 where  i.userAccount=#userAccount#
				 ) 
				 t where 1=1
			  group by t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit
			 ) t
		  <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
           <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
           <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
	 </select>
	 
	 <!-- 查询已录入全部项目 -->
	  <select id="selectIntermediaryAuditsubmitallpage" parameterClass="IntermediaryAudit" resultClass="IntermediaryAudit">   
	     select t.* from
		 (
		  select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm ,t.auditoktime,t.isUrgent,t.timeLimit from(
				select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,s.intermediarySendTime,i.deferday,i.auditoktime,s.intermediaryAuditTime,i.isconfirm,s.isUrgent,s.timeLimit
			    from pro_singleProjectArrange s inner join  pro_intermediaryaudit i on s.id=i.arrangeId 
				inner join pro_datapreinfo d on d.id=s.datapreId
				where  i.userAccount=#userAccount#) t where 1=1
		 union all
		 select t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit from
		(
		select pa.id as arrangeId,pa.packageName as projectName,d.proownerid,pa.sendAmount as sentAmount,pa.intermediaryId,i.id as interid,i.auditoktime,pa.intermediarySendTime,pa.intermediaryAuditTime,i.isconfirm ,pa.isUrgent,pa.timeLimit   from pro_packProjectRelate pr 
		 inner join pro_packProjectArrange pa on pr.projectPackId=pa.id
		 inner join pro_datapreinfo d on  d.id=pr.projectId
		 inner join pro_intermediaryaudit i on i.arrangeId=pa.id
		 where  i.userAccount=#userAccount#
		 ) 
		 t where 1=1
				 
		  group by t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm ,t.auditoktime ,t.isUrgent,t.timeLimit
		) t where 1=1  
		 <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
         <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
          <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
          <dynamic prepend="order by">
             <isNotEmpty property="filed">
                       $filed$ $sort$
             </isNotEmpty>
         </dynamic>
	  </select>
	  <!-- 查询已录入的全部项目 -->
	   <select id="selectIntermediaryAuditsubmitallcount" parameterClass="IntermediaryAudit" resultClass="java.lang.Integer">   
	       select count(1) from
		 (
		 select t.arrangeId ,t.projectName as projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime ,t.isUrgent,t.timeLimit from(
				select s.id as arrangeId,d.projectName,d.proownerid,d.sentAmount,s.intermediaryId,s.intermediarySendTime,i.deferday,i.auditoktime,s.intermediaryAuditTime,i.isconfirm,s.isUrgent,s.timeLimit
			    from pro_singleProjectArrange s inner join  pro_intermediaryaudit i on s.id=i.arrangeId 
				inner join pro_datapreinfo d on d.id=s.datapreId
				where  i.userAccount=#userAccount#) t where 1=1
		 union all
		 select t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit from
		(
		select pa.id as arrangeId,pa.packageName as projectName,d.proownerid,pa.sendAmount as sentAmount,pa.intermediaryId,i.id as interid,i.auditoktime,pa.intermediarySendTime,pa.intermediaryAuditTime,i.isconfirm ,pa.isUrgent,pa.timeLimit   from pro_packProjectRelate pr 
		 inner join pro_packProjectArrange pa on pr.projectPackId=pa.id
		 inner join pro_datapreinfo d on  d.id=pr.projectId
		 inner join pro_intermediaryaudit i on i.arrangeId=pa.id
		 where  i.userAccount=#userAccount#
		 ) 
		 t where 1=1
				 
		  group by t.arrangeId ,t.projectName,t.proownerid,t.sentAmount,t.intermediaryId,t.intermediarySendTime,t.intermediaryAuditTime,t.isconfirm,t.auditoktime,t.isUrgent,t.timeLimit
		) t where 1=1  
		 <dynamic prepend="and">
             <isNotEmpty property="projectName">
                       projectName like '%$projectName$%'
             </isNotEmpty>
         </dynamic>
          <dynamic prepend="and">
             <isNotEmpty property="proownerid">
                       proownerid = #proownerid#
             </isNotEmpty>
         </dynamic>
          <isNotEmpty property="beginTime">
                 AND  t.intermediaryAuditTime >= #beginTime#
         </isNotEmpty>
         <isNotEmpty property="endTime">
         <![CDATA[ 
                 AND  t.intermediaryAuditTime <= #endTime#
           ]]> 
         </isNotEmpty>
         
         <isNotEmpty property="timeLimitStart">
                 AND  t.timeLimit >= #timeLimitStart#
         </isNotEmpty>
         <isNotEmpty property="timeLimitEnd">
         <![CDATA[ 
                 AND  t.timeLimit <= #timeLimitEnd#
           ]]> 
         </isNotEmpty>
         <isNotEmpty property="isUrgent">
                 AND  t.isUrgent = #isUrgent#
         </isNotEmpty>
         <dynamic prepend="and">
             <isNotEmpty property="intermediaryId">
                       intermediaryId = #intermediaryId#
             </isNotEmpty>
         </dynamic>
	   </select>
	 <!-- 更改中介机构设置审核状态 -->
	 <update id="updatePackintermediaryState" parameterClass="com.audit.entity.project.PackProjectArrange">
		UPDATE
		pro_packProjectArrange
		SET
		intermediaryAuditState =#intermediaryAuditState#
		WHERE id = #id#
	</update>
	<update id="updateSingleintermediaryState" parameterClass="com.audit.entity.project.SingleProjectArrange">
		UPDATE
		pro_singleProjectArrange
		SET
		intermediaryAuditState =#intermediaryAuditState#
		WHERE id = #id#
	</update>
	 <!-- 查询科长未同意信息 -->
	<select id="selectsectionauditnopassstate" parameterClass="java.lang.String" resultClass="com.audit.entity.project.SectionChiefAuditBaseInfo">
	   select * from pro_sectionChiefAudit where projectDateId = #arrangeId# and passState=1  order by createTime desc
	</select>
</sqlMap>

