<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="AreaLeaderAudit">

	<!-- 获取法制科滞留项目总数 -->
	<select id="getLegalRetentionProejctCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT
		count(1) FROM
		(
		SELECT
		distinct
		(t1.id),t2.projectName,t3.ownerName,t5.username,t6.intermediaryname
		as
		intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid = t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId = t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		distinct (t1.id), t1.packageName as
		projectName,t3.ownerName,t5.username,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t1.projectDateId
		FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState
		= '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		union
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		projectDateId FROM dbo.pro_legalSectionChiefAudit
		)
		AND id not in (
		SELECT
		projectDateId FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		AND id in (
		SELECT t.projectId FROM dbo.pro_governmentEmployeeAudit t
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>


	<!-- 获取法制科滞留项目 -->
	<select id="getLegalRetentionProejct" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct
		(t1.id),t2.projectName,t3.ownerName,t5.username as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		distinct (t1.id), t1.packageName as
		projectName,t3.ownerName,t5.username as
		mainAuditName,t6.intermediaryname
		as intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId
		= t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t1.projectDateId FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState = '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		union
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		distinct
		(t1.id),t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		WHERE t1.id
		not in (
		SELECT
		projectDateId FROM dbo.pro_legalSectionChiefAudit
		)
		AND
		t1.id in (
		SELECT t.projectId FROM dbo.pro_governmentEmployeeAudit t
		)
		AND t1.id not in (
		SELECT
		projectDateId FROM dbo.pro_areaLeaderAudit
		WHERE passState = '2'
		)
		union
		SELECT
		distinct (t1.id), t1.packageName as
		projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId
		= t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		WHERE t1.id
		not in (
		SELECT
		projectDateId FROM dbo.pro_legalSectionChiefAudit
		)
		AND
		t1.id in (
		SELECT t.projectId FROM dbo.pro_governmentEmployeeAudit t
		)
		AND t1.id not in (
		SELECT
		projectDateId FROM dbo.pro_areaLeaderAudit
		WHERE passState = '2'
		)
		) t
		WHERE t.id
		in (SELECT t1.projectDateId FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState =
		'2')
		)
		AND id not in (
		SELECT
		projectDateId FROM
		dbo.pro_legalSectionChiefAudit)
		AND id in (
		SELECT t.projectId FROM
		dbo.pro_governmentEmployeeAudit t
		)
		AND id not in (
		SELECT
		projectDateId
		FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<!-- 获取法制科滞留打包项目总数 -->
	<select id="getLegalRetentionPackProejctCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT
		count(1) FROM
		(
		SELECT
		distinct (t1.id), t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t1.projectDateId
		FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState
		= '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		union
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		projectDateId FROM dbo.pro_legalSectionChiefAudit
		)
		AND id in (
		SELECT
		t.projectId FROM dbo.pro_governmentEmployeeAudit t
		)
		AND id not in (
		SELECT
		projectDateId FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>


	<!-- 获取法制科滞留打包项目 -->
	<select id="getLegalRetentionPackProejct" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct (t1.id), t1.packageName as
		projectName,t3.ownerName,t5.username as
		mainAuditName,t6.intermediaryname
		as intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId
		= t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t1.projectDateId FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState = '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		union
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT
		JOIN dbo.pro_packProjectRelate t7
		ON
		t1.id = t7.projectPackId
		inner JOin
		dbo.flowView_mywork t2
		ON
		t7.projectId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t7.projectId =
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		t1.id,t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		t1.id, t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t1.projectDateId
		FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState
		= '2')
		AND t.id not in (
		SELECT
		projectDateId FROM
		dbo.pro_legalSectionChiefAudit
		))
		AND id not in (
		SELECT
		projectDateId
		FROM
		dbo.pro_legalSectionChiefAudit)
		AND id in (
		SELECT t.projectId FROM
		dbo.pro_governmentEmployeeAudit t
		)
		AND id not in (
		SELECT
		projectDateId
		FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<!-- 获取法制科滞留项目总数 -->
	<select id="getLegalRetentionSingleProejctCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT
		count(1) FROM
		(
		SELECT
		distinct
		(t1.id),t2.projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid = t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId = t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t1.projectDateId FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState = '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		) AND id not in (
		SELECT
		projectDateId FROM dbo.pro_legalSectionChiefAudit
		)
		AND id in (
		SELECT
		t.projectId FROM dbo.pro_governmentEmployeeAudit t
		)
		AND id not in (
		SELECT
		projectDateId FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>


	<!-- 获取法制科滞留项目 -->
	<select id="getLegalRetentionSingleProejct" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct (t1.id),t2.projectName,t3.ownerName,t5.username as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t1.projectDateId FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState = '2')
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		t1.id,t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		t1.id, t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t1.projectDateId
		FROM
		dbo.pro_sectionChiefAudit t1
		WHERE
		t1.isSubmit = '1'
		AND t1.passState
		= '2')
		AND t.id not in (
		SELECT
		projectDateId FROM
		dbo.pro_legalSectionChiefAudit
		))
		AND id not in (
		SELECT
		projectDateId
		FROM
		dbo.pro_legalSectionChiefAudit)
		AND id in (
		SELECT t.projectId FROM
		dbo.pro_governmentEmployeeAudit t
		)
		AND id not in (
		SELECT
		projectDateId
		FROM dbo.pro_areaLeaderAudit WHERE passState = '2'
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<insert id="addAreaLeaderAuditAudit" parameterClass="com.audit.entity.project.SectionChiefAuditBaseInfo">
		INSERT INTO
		dbo.pro_areaLeaderAudit
		(id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime)
		VALUES
		(#id#
		,#projectDateId#
		,#remark#
		,#userAccount#
		,#passState#
		,#isSubmit#
		,getdate())
	</insert>

	<select id="checkIsExistLegalAreaLeaderAuditInfo"
		parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT id FROM
		dbo.pro_legalAreaLeaderAudit
		WHERE projectDateId = #projectDateId#
	</select>

	<select id="checkIsExistLegalSectionChiefAuditInfo"
		parameterClass="java.lang.String" resultClass="java.lang.String">
		SELECT id FROM
		dbo.pro_legalSectionChiefAudit
		WHERE projectDateId = #projectDateId#
	</select>

	<update id="updateLegalAreaLeaderAuditState" parameterClass="java.lang.String">
		UPDATE dbo.pro_legalAreaLeaderAudit
		SET
		isSubmit = '0'
		WHERE id = #id#
	</update>

	<update id="updateLegalSectionChiefAuditState" parameterClass="java.lang.String">
		UPDATE dbo.pro_legalSectionChiefAudit
		SET
		isSubmit = '0'
		WHERE id = #id#
	</update>

	<update id="updateSectionChiefAuditState" parameterClass="java.lang.String">
		UPDATE
		dbo.pro_sectionChiefAudit
		SET
		isSubmit = '0'
		WHERE projectDateId = #id#
	</update>

	<update id="updateAreaLeaderAuditInfo" parameterClass="com.audit.entity.project.SectionChiefAuditBaseInfo">
		UPDATE
		dbo.pro_areaLeaderAudit
		SET
		remark = #remark#
		,passState = #passState#
		,createTime = getDate()
		WHERE id= #id#
	</update>

	<select id="getAreaLeaderAuditBaseInfo" parameterClass="com.audit.entity.project.SectionChiefAuditBaseInfo"
		resultClass="com.audit.entity.project.SectionChiefAuditBaseInfo">
		SELECT
		id
		,projectDateId
		,remark
		,userAccount
		,passState
		,isSubmit
		,createTime
		FROM
		dbo.pro_areaLeaderAudit
		WHERE
		userAccount =
		#userAccount#
		AND
		projectDateId = #projectDateId#
	</select>

	<select id="findAreaLeaderAuditSingleProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
	</select>

	<select id="findAreaLeaderAuditSingleProject" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct (t1.id),t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		t1.id,t2.projectName,t3.ownerName,t5.userAccount as
		mainAuditName,t6.intermediaryname
		as intermediary
		FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t2.proownerid =
		t3.id
		LEFT JOIN
		dbo.pro_employeeArrangeRelate t4
		ON
		t4.projectArrangeId =
		t1.id
		LEFT JOIN
		dbo.sys_userinfo t5
		ON t1.mainAuditId = t5.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		union
		SELECT
		t1.id, t1.packageName as
		projectName,t3.ownerName,t5.userAccount,t6.intermediaryname
		as
		intermediary FROM
		dbo.pro_packProjectArrange
		t1
		LEFT JOIN
		dbo.pro_packProjectRelate t2
		ON
		t1.id = t2.projectPackId
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t1.ownerId = t3.id
		LEFT JOIN dbo.sys_userinfo
		t5
		ON t1.mainAuditId = t5.id
		LEFT JOIN dbo.sys_intermediaryagency t6
		ON
		t6.id = t1.intermediaryId
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#)
		AND id not
		in (
		SELECT
		t1.id
		FROM
		dbo.pro_singleProjectArrange t1
		inner
		JOin
		dbo.flowView_mywork t2
		ON
		t1.datapreId = t2.projectDateId
		AND
		t2.userAccount = #userAccount#
		AND
		t2.module = #moduleId#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t1.datapreId
		=
		t3.id
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t3.proownerid = t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<select id="findAreaLeaderAuditPackProjectCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT count(1) FROM (
		SELECT
		distinct (t1.id)
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN
		dbo.sys_projectowner t3
		ON
		t1.ownerId = t3.id
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t1.packageName like
			'%$projectName$%'
		</isNotEmpty>
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
	</select>

	<select id="findAreaLeaderAuditPackProject" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,mainAuditName,intermediary FROM
		(
		SELECT
		distinct t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id
		in (SELECT t.projectDateId FROM dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#
		)
		AND id not in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		AND id not in (
		SELECT
		top($pagesize$*($pageno$
		-
		1)) id FROM
		(
		SELECT
		distinct
		t2.id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_sectionChiefAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		(SELECT t3.projectId FROM dbo.pro_governmentEmployeeAudit t3 where
		t3.id=t1.projectDateId
		union
		SELECT t2.arrangeId FROM
		dbo.pro_intermediaryaudit t2 where
		id=t1.projectDateId) = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id = t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t3.id is not null
		) t
		WHERE t.id in (SELECT t.projectDateId FROM
		dbo.pro_areaLeaderAudit t
		WHERE
		userAccount = #userAccount#)
		AND id not
		in (
		SELECT
		distinct t1.id
		FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.pro_packProjectRelate
		t2
		ON t1.id = t2.projectPackId
		inner
		JOin
		dbo.flowView_mywork t3
		ON
		t2.projectId = t3.projectDateId
		AND
		t3.userAccount = #userAccount#
		AND
		t3.module = #moduleId#
		LEFT JOIN
		dbo.sys_projectowner t4
		ON t1.ownerId =
		t4.id
		LEFT
		JOIN
		dbo.sys_intermediaryagency t5
		ON t1.intermediaryId = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t1.mainAuditId = t6.id
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<isNotEmpty property="ownerName">
			AND ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND projectName like '%$projectName$%'
		</isNotEmpty>
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>


	<select id="findAreaLeaderAuditAllProjectCount" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="java.lang.Integer">
		SELECT count(distinct id) FROM (
		SELECT
		t1.id as id FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON
		t3.id
		= t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId = t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT t1.id as id FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		AND
		t1.userAccount = #userAccount#
		LEFT JOIN dbo.pro_packProjectRelate
		t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) t
	</select>

	<select id="findAreaLeaderAuditAllProject" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$
		id,projectName,ownerName,intermediary,mainAuditName FROM (
		SELECT
		t2.id
		as id,t2.packageName as projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id,t3.projectName,t4.intermediaryname as
		intermediary,t5.ownerName,t6.username as mainAuditName
		FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON
		t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE t2.id is not
		null
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t3.projectName like
			'%$projectName$%'
        </isNotEmpty>
		) t
		WHERE (id not in (
		SELECT top($pagesize$*($pageno$ - 1)) id
		FROM
		(SELECT t2.id FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_packProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT JOIN
		dbo.pro_packProjectRelate t7
		ON
		t7.projectPackId = t2.id
		LEFT JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t7.projectId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		union
		SELECT
		t2.id
		FROM
		dbo.pro_areaLeaderAudit t1
		LEFT JOIN
		dbo.pro_singleProjectArrange t2
		ON t1.projectDateId = t2.id
		LEFT
		JOIN
		dbo.pro_datapreinfo t3
		ON t3.id =
		t2.datapreId
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON
		t2.intermediaryId
		= t4.id
		LEFT JOIN
		dbo.sys_projectowner t5
		ON
		t3.proownerid = t5.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t2.mainAuditId = t6.id
		WHERE 1=1
		<isNotEmpty property="ownerName">
			AND t5.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.packageName like
			'%$projectName$%'
        </isNotEmpty>
		) ta
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<!-- 获取主审雇员信息 -->
	<select id="getMianAuditEmployee" parameterClass="java.lang.String"
		resultClass="java.lang.String">
		SELECT t2.userAccount FROM dbo.pro_singleProjectArrange t1
		LEFT JOIN dbo.sys_userinfo t2
		ON t1.mainAuditId = t2.id
		WHERE
		t1.datapreId = #id#
		union
		SELECT t2.userAccount FROM
		dbo.pro_packProjectArrange t1
		LEFT JOIN dbo.sys_userinfo t2
		ON
		t1.mainAuditId = t2.id
		LEFT JOIN dbo.pro_packProjectRelate t3
		ON
		t3.projectPackId = t1.id
		WHERE t3.projectId = #id#
	</select>

	<!-- 获取待分管领导确认的安排信息总数 -->
	<select id="findAreaLeaderArrangeAffirmProjectCount"
		parameterClass="com.audit.entity.project.AuditInfo" resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM (
		SELECT distinct t1.id FROM dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t2.proownerid = t3.id
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON t1.intermediaryId = t4.id
		RIGHT JOIN
		dbo.flowView_mywork t5
		ON t5.projectDateId = t2.id
		LEFT JOIN
		dbo.sys_userinfo t6
		ON t6.id = t1.mainAuditId
		WHERE t1.id is not null
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.projectName like
			'%$projectName$%'
        </isNotEmpty>
		<isEqual property="auditType" compareValue="0">
			AND t1.isUrgent is null
			AND t1.timeLimit is null
			AND t5.userAccount = #userAccount#
			AND t5.module = #moduleId#
        </isEqual>
		<isEqual property="auditType" compareValue="1">
			AND t1.isUrgent is
			not null
        </isEqual>
		) t
	</select>

	<!-- 获取待分管领导确认的安排信息 -->
	<select id="findAreaLeaderArrangeAffirmProject" parameterClass="com.audit.entity.project.AuditInfo"
		resultClass="com.audit.entity.project.AuditInfo">
		SELECT top $pagesize$ id,projectName,ownerName,intermediary, mainAuditName FROM
		(
		SELECT distinct t1.id, t2.projectName, t3.ownerName,
		t4.intermediaryName as
		intermediary,
		t6.username as mainAuditName FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN dbo.sys_projectowner t3
		ON t2.proownerid
		= t3.id
		LEFT JOIN dbo.sys_intermediaryagency t4
		ON t1.intermediaryId =
		t4.id
		RIGHT JOIN dbo.flowView_mywork t5
		ON t5.projectDateId = t2.id
		LEFT
		JOIN dbo.sys_userinfo t6
		ON t6.id = t1.mainAuditId
		WHERE t1.id is not null
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.projectName like
			'%$projectName$%'
        </isNotEmpty>
		<isEqual property="auditType" compareValue="0">
			AND t1.isUrgent is
			null
			AND t1.timeLimit is null
			AND t5.userAccount = #userAccount#
			AND t5.module = #moduleId#
        </isEqual>
		<isEqual property="auditType" compareValue="1">
			AND t1.isUrgent is not null
        </isEqual>
		) t
		WHERE id not in (
		SELECT top($pagesize$*($pageno$ - 1)) id FROM (
		SELECT distinct t1.id FROM
		dbo.pro_singleProjectArrange t1
		LEFT JOIN
		dbo.pro_datapreinfo t2
		ON
		t1.datapreId = t2.id
		LEFT JOIN
		dbo.sys_projectowner t3
		ON t2.proownerid
		= t3.id
		LEFT JOIN
		dbo.sys_intermediaryagency t4
		ON t1.intermediaryId =
		t4.id
		RIGHT JOIN
		dbo.flowView_mywork t5
		ON t5.projectDateId = t2.id
		LEFT
		JOIN
		dbo.sys_userinfo t6
		ON t6.id = t1.mainAuditId
		WHERE t1.id is not null
		<isNotEmpty property="ownerName">
			AND t3.ownerName like '%$ownerName$%'
		</isNotEmpty>
		<isNotEmpty property="projectName">
			AND t2.projectName like
			'%$projectName$%'
        </isNotEmpty>
		<isEqual property="auditType" compareValue="0">
			AND t1.isUrgent is
			null
			AND t1.timeLimit is null
			AND t5.userAccount = #userAccount#
			AND t5.module = #moduleId#
        </isEqual>
		<isEqual property="auditType" compareValue="1">
			AND t1.isUrgent is
			not null
        </isEqual>
		) t0
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
		)
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			order by id desc
	    </isEmpty>
	</select>

	<!-- 更新安排信息内容 -->
	<update id="updateArrangeInfoByAreaLeader" parameterClass="com.audit.entity.project.ArrangeInfo">
		UPDATE dbo.pro_singleProjectArrange
		SET
		isUrgent = #isUrgent#
		<isNotEmpty property="timeLimit">
		,timeLimit = #timeLimit#
		</isNotEmpty>
		,areaauditRemark=#areaauditRemark#
		WHERE id = #arrangeId#
	</update>

	<!-- 获取安排信息 -->
	<select id="selectArrangeInfoByAreaLeader" parameterClass="java.lang.String"
		resultClass="com.audit.entity.project.ArrangeInfo">
		SELECT isUrgent, timeLimit,areaauditRemark FROM
		dbo.pro_singleProjectArrange WHERE id = #id#
	</select>
</sqlMap>

