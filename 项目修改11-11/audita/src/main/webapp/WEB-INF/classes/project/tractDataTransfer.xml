<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="dataTransfer">

    <!-- 插入资料移交信息 -->
	<insert id="insertDataTransferInfo"
		parameterClass="com.audit.entity.project.TractProjectDataTransferInfo">
		INSERT INTO dbo.pro_tractProjectTransferData
		(id
		,tractProjectId
		,comprehensiveReportFile
		,createTime
		,updateTime
		,createUserAccount
		,updateUserAccount)
		VALUES
		(#id#
		,#tractProjectId#
		,#comprehensiveReportFile#
		,#createTime#
		,getDate()
		,#createUserAccount#
		,#updateUserAccount#)
    </insert>

    <!-- 更新资料移交信息 -->
	<update id="updateDataTransferInfo"
		parameterClass="com.audit.entity.project.TractProjectDataTransferInfo">
		UPDATE dbo.pro_tractProjectTransferData
		SET
		comprehensiveReportFile = #comprehensiveReportFile#
		,updateTime =
		getDate()
		,updateUserAccount = #updateUserAccount#
		WHERE id = #id#
	</update>

     <!-- 增加跟踪审计移交信息 -->
    <insert id="addDataTurn" parameterClass="com.audit.entity.project.TractDataTurnList">
         insert into pro_tractDataTurnList(id,biaoDuanId,xuhao,dataname,have,scores,pagenumber,pagination,bigtype,smalltype)
         values
         (#id#,#biaoDuanId#,#xuhao#,#dataname#,#have#,#scores#,#pagenumber#,#pagination#,#bigtype#,#smalltype#)
    
    </insert>
    
    <!-- 按标段删除跟踪审计移交信息 -->
     <delete id="delDataTurn" parameterClass="java.lang.String">
         delete from pro_tractDataTurnList where biaoDuanId=#id#
     </delete>
     
     <!-- 按标段id查询跟踪审计移交信息 -->
   <select id="selectDataTurn" parameterClass="java.lang.String"  resultClass="com.audit.entity.project.TractDataTurnList">
      select * from pro_tractDataTurnList where biaoDuanId=#id# order by xuhao asc
   </select>

    <!-- 查询资料移交信息 -->
	<select id="selectDataTransferInfo" parameterClass="java.lang.String"
		resultClass="com.audit.entity.project.TractProjectDataTransferInfo">
		SELECT t1.id
		,t1.tractProjectId
		,t1.comprehensiveReportFile
		,t1.createTime
		,t1.updateTime
		,t1.updateUserAccount
		,t2.username as createUserAccount
		FROM dbo.pro_tractProjectTransferData t1
		LEFT JOIN dbo.sys_userinfo t2
		ON t2.userAccount = t1.createUserAccount
		WHERE tractProjectId = #id#
	</select>

    <!-- 更改标段的移交状态改为已移交  -->
	<update id="updateBiaoDuanTransferState" parameterClass="java.lang.String">
		UPDATE dbo.pro_tractBiaoDuanCreate
		SET
		dataTransferState = 1
		WHERE id = #id#
	</update>
</sqlMap>
