<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="common">

	<typeAlias alias="function" type="com.audit.entity.Function" />
	<select id="selectCommonCompetence" parameterClass="com.audit.entity.FunctionCompetenceSqlInput"
		resultClass="function">
		SELECT id,method FROM (SELECT distinct t1.id, t1.method,t1.sort FROM
		sys_function t1
		LEFT JOIN sys_modulefun t2
		ON t1.id=t2.functionId
		LEFT JOIN sys_rolemodulefun t3
		ON t3.modulefunId = t2.id
		LEFT JOIN dbo.sys_roleuser t4
		ON t4.roleId = t3.roleId
		LEFT JOIN dbo.sys_userInfo t5
		ON t4.userId = t5.id
		WHERE t2.moduleId=#menuId#
		AND t1.state=0
		AND t5.userAccount = #userAccount#
		) t
		ORDER BY t.sort ASC
   </select>

   <select id="checkIsKeZhang" parameterClass="com.audit.entity.User"
		resultClass="java.lang.Integer">
		SELECT COUNT(1) FROM dbo.sys_roleuser t
		LEFT JOIN dbo.sys_userinfo t1
		ON t1.id = t.userid
		WHERE t.roleid = #remark#
		AND t1.userAccount = #userAccount#
	</select>


	<!-- 获取法制科滞留的项目 -->
	<select id="getLegalDeptAllProject" parameterClass="java.lang.String"
		resultClass="com.audit.entity.work.MyNoCompleteWorkInfo">
		SELECT
		t0.projectDateId as id,SUBSTRING(CONVERT(varchar,Max(t1.updateTime),
		120),0,12) as startTime FROM dbo.flowView_mywork t0
		LEFT JOIN
		dbo.sys_flowRecord t1
		ON t0.flowId = t1.flowId
		WHERE t0.userAccount in
		(SELECT t2.userAccount FROM dbo.sys_role t
		LEFT JOIN dbo.sys_roleuser t1
		ON t.id = t1.roleid
		LEFT JOIN dbo.sys_userinfo t2
		ON t1.userid = t2.id
		WHERE t.id = 'R012')
		GROUP BY t0.projectDateId
    </select>
</sqlMap>

