<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap 
    PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" 
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="function">

	<typeAlias alias="function" type="com.audit.entity.Function" />
	
	<select id="getFunction" resultClass="function">
		select method from sys_function
	</select>

	<select id="getFunctionByIndexCount" parameterClass="function"
		resultClass="function">
	<![CDATA[
		SELECT TOP $pagesize$ t1.id,t1.name,t1.method,t1.icon,t1.state,t1.createTime,t1.remark
		FROM (SELECT * FROM dbo.sys_function) t1
		WHERE (id NOT IN(SELECT TOP ($pagesize$* $pageno$) id FROM
				]]>
		(SELECT * FROM dbo.sys_function) t2
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			ORDER BY id ASC
	    </isEmpty>
		))
		<dynamic prepend="order by">
			<isNotEmpty property="filed">
				$filed$ $sort$
             </isNotEmpty>
		</dynamic>
		<isEmpty property="filed">
			ORDER BY id ASC
	    </isEmpty>
	</select>

	<select id="getFunctionCount" resultClass="java.lang.Integer">
		SELECT count(1) FROM
		dbo.sys_function
    </select>

	<select id="functionMaxID" resultClass="java.lang.Integer">
		Select max(SUBSTRING
		(id,2,len(id)))from dbo.sys_function
	</select>

	<insert id="addFunction" parameterClass="function">
		INSERT INTO
		dbo.sys_function
		(id
		,name
		,method
		,icon
		,state
		,createTime
		,remark)
		VALUES
		(
		#id#
		,#name#
		,#method#
		,#icon#
		,#state#
		,GETDATE()
		,#remark#)
	</insert>

	<update id="updateFunction" parameterClass="function">
		UPDATE
		dbo.sys_function
		SET
		createTime = GETDATE()
		, name = #name#
		, method = #method#
		, state = #state#
		, remark = #remark#
		WHERE
		id = #id#
	</update>
	
	<update id="destoryFunction" parameterClass="function">
		UPDATE
		dbo.sys_function
		SET
		createTime = GETDATE()
		, state = #state#
		WHERE
		id = #id#
	</update>
	

	<delete id="deleteFunction" parameterClass="java.lang.String">
		DELETE FROM
		dbo.sys_function WHERE id = #id#
   </delete>

	<select id="getFunctionById" parameterClass="java.lang.String"
		resultClass="function">
		SELECT id,name,method,icon,state,createTime,remark FROM
		dbo.sys_function
		WHERE id = #id#
   </select>
</sqlMap>

